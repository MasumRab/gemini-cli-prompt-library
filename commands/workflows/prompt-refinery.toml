description = "Enhanced workflow for the prompt engineering lifecycle with DSPy integration"
args = "task_description"
prompt = """
# Enhanced Prompt Refinery Workflow with DSPy Integration

You are guiding the user through the "Prompt Refinery" process: a linear workflow to create, evaluate, and perfect LLM prompts using advanced DSPy techniques.

## Phase 1: Context & Setup
**Task:** {{task_description}}

1. **Establish Workspace:**
   - Create a directory: `.prompts/history/{{task_description}}/`
   - *Note: Ensure the directory name is safe for your file system (e.g., use a slug or short name).*
   - You will save versions here (e.g., `v1.md`, `v2.md`).

2. **Chain of Thought Analysis:**
   - Analyze the prompt requirements systematically
   - Identify potential optimization opportunities
   - Determine if DSPy conversion would be beneficial

3. **Drafting (Step 1):**
   - If you have a draft, paste it below.
   - If not, use `/prompt/create-template "{{task_description}}"` to generate V1.
   - **Action:** Save this draft as `v1.md`.

## Phase 2: DSPy-Enhanced Evaluation & Refinement Loop

*Repeat this loop until Score > 35/40.*

1. **Evaluate:**
   - Run: `/prompt/evaluate "{{ '{{current_prompt_text}}' }}"`
   - **Output:** Note the Score and the "Recommended Next Step".
   - **DSPy Assessment:** Determine if the prompt would benefit from DSPy conversion.

2. **Refine (if Score < 30):**
   - Run: `/prompt/refine "{{ '{{current_prompt_text}}' }} --feedback {{ '{{evaluation_flaws}}' }}"`
   - **Action:** Save the result as `vNext.md`.

3. **DSPy Conversion (if DSPy Optimization Potential > 7):**
   - Run: `/prompts:dspy-convert "{{ '{{current_prompt_text}}' }}"`
   - **Action:** Save the DSPy module and compare performance.

4. **Verify (if Score > 30):**
   - Run: `/prompt/test-case "{{ '{{current_prompt_text}}' }}"`
   - Manually check the prompt against the 5 generated test cases.
   - **Confidence Assessment:** Rate the confidence in the prompt's effectiveness.
   - If it fails, go back to **Refine**.

## Phase 3: DSPy Optimization (Optional)

If the prompt shows high DSPy optimization potential:

1. **Module Creation:**
   - Convert to a DSPy module using appropriate patterns (ChainOfThought, ReAct, etc.)
   - Implement the signature with proper input/output validation

2. **Optimization:**
   - Apply BootstrapFewShot or MIPRO optimization as appropriate
   - Test optimized version against original

3. **Comparison:**
   - Compare performance between original and optimized versions
   - Select the best-performing variant

## Phase 4: Finalization

Once the prompt passes evaluation (>35) and testing:

1. **Final Save:**
   - Save the final content to your active prompts library (e.g., `commands/prompts/my-new-prompt.toml`).
   - If DSPy version performed better, save that as well.

2. **Documentation:**
   - Append a usage guide based on the "Happy Path" test case.
   - Document any DSPy-specific features or optimizations.

## Current Status Request
Where are you in this process?
- [ ] Just starting (Need Draft)
- [ ] Have Draft (Need Evaluation)
- [ ] Have Evaluation (Need Refinement)
- [ ] Testing
- [ ] DSPy Optimization
- [ ] Finalization
"""
